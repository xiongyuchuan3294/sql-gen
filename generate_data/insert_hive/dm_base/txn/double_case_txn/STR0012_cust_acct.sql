#!/usr/bin
# -*- coding: utf-8 -*- 
# @Time     : 2024/1/2 15:44
# @Author   : v_peterliu
# @Email    : v_peterliu@webank.com
# @File     : STR0012_cust_acct.sql


-- STR0012
-- 疑似赌博犯罪-个人
--R2701：职业为无业或自由职业、学生、其他                                   imd_dm_afe.rrs_bdm_icustomer_merger_mid 表职业类型字段 occupation_type 为 H|L|N|1H
--R2206：监测低龄和高龄客户开卡   P0077>=65 或 <=23   对私客户年龄 		  imd_dm_afe.rrs_bdm_icustomer_merger_mid  birthday 算出年龄，年龄>=65 or  年龄<=23
--R0103：短期内对私本币账户资金分散转入、集中转出或者集中转入、分散转出(3个指标且的关系)
--1、流出次数/流入次数  "P0001>=3或P0001<=1/3
--2、客户资金流入人民币资金（转账） P0002>=20万   --- imd_dm_afe.rrs_bdm_icustomer_merger_mid   cash_flag = 0 and receive_pay_cd = '01'  and  trans_amount>=200000
--3、流入累计金额/流出累计金额  0.9=<P0004<=1.1"
--
--单日现金转入金额：cash_flag = 0 and receive_pay_cd = '01'
--单日现金转出金额: cash_flag = 0 and receive_pay_cd = '02'

--case crdr_flag when '0' then '02' when '1' then '01' END AS receive_pay_cd --17.资金收付标志
--CASE WHEN detail_mid.scenario_id in ('UP_ATM_WITHDRAW_ABOARD','UP_ATM_WITHDRAW') THEN '0'   -- 现标识是现金,涉及到场景码是 atm 取款的,都是现金
-- WHEN detail_mid.cash_flag='0' THEN '0'  ELSE '1' END AS cash_flag  --25.现转标识 0-现金 1-转账

--交易造数要求：造4笔交易数据就可以满足。分别在不同的分区，
--1.转出3次 累计金额在18万~22万，转入1次，金额20万
--2.交易时间在 22:00-06:00

----对私客户表造数
insert into rrs_bdm_icustomer_merger_mid partition(ds='2023-12-17',sysid='ECIF') select '2023-12-17' as data_dt,'0948176566990574' as cust_id,'疑似赌博犯罪-个人001' as cust_name,org_id,'1' as gender,'1953-06-06' as birthday,marital_status,edu_background,degree,profession,home_tel,'13394686666' as mobile_phone,busi_phone,fax_number,other_number,email,postal_add,postcode,census_reg_add,resident_flg,city_village_flg,related_flg,stock_pct,'01' as id_type,'321281195306067118' as id_no,'01' as  cust_type,indu_type,'CHN' as country_code,income_family_avg_m,company_name,company_add,company_postcode,employed_year,duty,title,year_income,wage_acct,wage_acct_bank,live_add,live_postcode,dwelling_condition,spouse_name,spouse_id_type,spouse_id_no,spouse_company,spouse_phone,onoff_flg,sys_src_cd,limit_500_flg,'0948176566990574' as new_cust_id,is_staff,source,'N' as occupation_type,'汉族' as nation,id_expiry_date,licence_issuing,id_add,effective_date,spouse_telephone,personal_monthly_income,family_monthly_income,spouse_ecif_no,unit_properties,telephone_area_code,other_add,payroll_credit,personal_annual_income,family_annual_income, occupation_type_new, occupation_type_new_sysid, busi_phone_new from rrs_bdm_icustomer_merger_mid where ds ='2020-02-01' limit 1;
insert into rrs_bdm_icustomer_merger_mid partition(ds='2023-12-17',sysid='ECIF') select '2023-12-17' as data_dt,'0925467535197630' as cust_id,'STR0012-对手001' as cust_name,org_id,'1' as gender,'1984-09-05' as birthday,marital_status,edu_background,degree,profession,home_tel,'13397686688' as mobile_phone,busi_phone,fax_number,other_number,email,postal_add,postcode,census_reg_add,resident_flg,city_village_flg,related_flg,stock_pct,'01' as id_type,'310000198409059147' as id_no,'01' as  cust_type,indu_type,'CHN' as country_code,income_family_avg_m,company_name,company_add,company_postcode,employed_year,duty,title,year_income,wage_acct,wage_acct_bank,live_add,live_postcode,dwelling_condition,spouse_name,spouse_id_type,spouse_id_no,spouse_company,spouse_phone,onoff_flg,sys_src_cd,limit_500_flg,'0925467535197630' as new_cust_id,is_staff,source,'N' as occupation_type,'汉族' as nation,id_expiry_date,licence_issuing,id_add,effective_date,spouse_telephone,personal_monthly_income,family_monthly_income,spouse_ecif_no,unit_properties,telephone_area_code,other_add,payroll_credit,personal_annual_income,family_annual_income, occupation_type_new, occupation_type_new_sysid, busi_phone_new from rrs_bdm_icustomer_merger_mid where ds ='2020-02-01' limit 1;

-- 备注：需要有3天的交易。因此也需要将这个维度数据差入到对应的交易日期中去。
insert into rrs_bdm_icustomer_merger_mid partition(ds='2023-12-16',sysid='ECIF') select data_dt, cust_id, cust_name, org_id, gender, birthday, marital_status, edu_background, degree, profession, home_tel, mobile_phone, busi_phone, fax_number, other_number, email, postal_add, postcode, census_reg_add, resident_flg, city_village_flg, related_flg, stock_pct, id_type, id_no, cust_type, indu_type, country_code, income_family_avg_m, company_name, company_add, company_postcode, employed_year, duty, title, year_income, wage_acct, wage_acct_bank, live_add, live_postcode, dwelling_condition, spouse_name, spouse_id_type, spouse_id_no, spouse_company, spouse_phone, onoff_flg, sys_src_cd, limit_500_flg, new_cust_id, is_staff, source, occupation_type, nation, id_expiry_date, licence_issuing, id_add, effective_date, spouse_telephone, personal_monthly_income, family_monthly_income, spouse_ecif_no, unit_properties, telephone_area_code, other_add, payroll_credit, personal_annual_income, family_annual_income, occupation_type_new, occupation_type_new_sysid, busi_phone_new from rrs_bdm_icustomer_merger_mid where ds ='2023-12-17';
insert into rrs_bdm_icustomer_merger_mid partition(ds='2023-12-15',sysid='ECIF') select data_dt, cust_id, cust_name, org_id, gender, birthday, marital_status, edu_background, degree, profession, home_tel, mobile_phone, busi_phone, fax_number, other_number, email, postal_add, postcode, census_reg_add, resident_flg, city_village_flg, related_flg, stock_pct, id_type, id_no, cust_type, indu_type, country_code, income_family_avg_m, company_name, company_add, company_postcode, employed_year, duty, title, year_income, wage_acct, wage_acct_bank, live_add, live_postcode, dwelling_condition, spouse_name, spouse_id_type, spouse_id_no, spouse_company, spouse_phone, onoff_flg, sys_src_cd, limit_500_flg, new_cust_id, is_staff, source, occupation_type, nation, id_expiry_date, licence_issuing, id_add, effective_date, spouse_telephone, personal_monthly_income, family_monthly_income, spouse_ecif_no, unit_properties, telephone_area_code, other_add, payroll_credit, personal_annual_income, family_annual_income, occupation_type_new, occupation_type_new_sysid, busi_phone_new from rrs_bdm_icustomer_merger_mid where ds ='2023-12-17';



----账户表造数
insert into table rrs_bdm_custacct_info_mid partition(ds ='2023-12-17',sysid='DEPOSIT') values
('2020-02-01',NULL ,'101001','I10000000050574','疑似赌博犯罪-个人001','9999602510110000040574','0948176566990574',NULL,NULL,'00','0','0','0',NULL,'A','CNY','N','0',NULL,'300000','N','2018-10-15','2020-05-25','0','0','2020-03-01','200000','0',NULL,NULL,'2018-09-25',NULL,'2020-06-18','0','A','2019-10-12','SYS_MB','MB','0','0','0','2020-02-01','CARDNO202003050090574','1','DEPOSIT','11200301','NA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'HS200301','c910b2ccfd99135db71c3817106c0574',NULL,'2018-10-15',NULL,'A','0948176566990574','A',NULL,'0',NULL,NULL,NULL,NULL,NULL,'10',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('2020-02-01',NULL ,'101001','I10000000057630','STR0012-对手001','9999602510110000047630','0925467535197630',NULL,NULL,'00','0','0','0',NULL,'A','CNY','N','0',NULL,'800000','N','2019-06-15','2020-06-25','0','0','2020-05-01','200000','0',NULL,NULL,'2018-09-25',NULL,'2020-06-18','0','A','2019-10-12','SYS_MB','MB','0','0','0','2020-02-01','CARDNO202003050097630','1','DEPOSIT','11200301','NA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'HS200301','c910b2ccfd99135db71c3817106c0574',NULL,'2018-10-15',NULL,'A','0925467535197630','A',NULL,'0',NULL,NULL,NULL,NULL,NULL,'10',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);

-- 备注：需要有3天的交易。因此也需要将这个维度数据差入到对应的交易日期中去。
insert into table rrs_bdm_custacct_info_mid partition(ds ='2023-12-16',sysid='DEPOSIT')select data_dt, item_cd, org_id, acct_no, acct_name, cust_acct_no, cust_id, type_of_custacct, type_of_cust, acct_type, acct_freeze_flag, acct_notpay_flag, acct_notin_flag, field_s_4, card_state, ccy, ccy_flag, amount, balance_falg, balance, bond_flag, start_date, mature_date, rate, base_rate, repricing_date, agreement_amt, agreement_rate, term_type, actual_term, open_date, close_date, next_pay_date, accrued_int, type_of_acct, last_mod_date, open_userid, open_chl, open_amount, acct_casa_flag, last_acct_balance, last_acct_bal_chg_date, card_no, base_subacct_flag, sys_src_cd, deposit_prod_cd, busi_rel_type, margin_acct_type, attr_code, bank_no, dailxinm, dailzjlx, dailzjho, dailguoj, dianhhma, accouting_code, open_trans_no, close_trans_no, cust_open_date, cust_close_date, cust_type_of_acct, cust_id_zhxinx, cust_card_stat, bank_id, accrued_int_rec, close_brn, close_teller, overdue_flag, nominal_custacct_type, custacct_attr_code, settlement_acct_state, open_time, close_time, cust_open_time, cust_close_time, dep_purpose, original_maturity_m, original_maturity_d, renew_seq_no, having_balance, cust_attr, bal_seq_no, deal_date, margin_type from rrs_bdm_custacct_info_mid where ds ='2023-12-17';
insert into table rrs_bdm_custacct_info_mid partition(ds ='2023-12-15',sysid='DEPOSIT')select data_dt, item_cd, org_id, acct_no, acct_name, cust_acct_no, cust_id, type_of_custacct, type_of_cust, acct_type, acct_freeze_flag, acct_notpay_flag, acct_notin_flag, field_s_4, card_state, ccy, ccy_flag, amount, balance_falg, balance, bond_flag, start_date, mature_date, rate, base_rate, repricing_date, agreement_amt, agreement_rate, term_type, actual_term, open_date, close_date, next_pay_date, accrued_int, type_of_acct, last_mod_date, open_userid, open_chl, open_amount, acct_casa_flag, last_acct_balance, last_acct_bal_chg_date, card_no, base_subacct_flag, sys_src_cd, deposit_prod_cd, busi_rel_type, margin_acct_type, attr_code, bank_no, dailxinm, dailzjlx, dailzjho, dailguoj, dianhhma, accouting_code, open_trans_no, close_trans_no, cust_open_date, cust_close_date, cust_type_of_acct, cust_id_zhxinx, cust_card_stat, bank_id, accrued_int_rec, close_brn, close_teller, overdue_flag, nominal_custacct_type, custacct_attr_code, settlement_acct_state, open_time, close_time, cust_open_time, cust_close_time, dep_purpose, original_maturity_m, original_maturity_d, renew_seq_no, having_balance, cust_attr, bal_seq_no, deal_date, margin_type from rrs_bdm_custacct_info_mid where ds ='2023-12-17';


----交易造数(转出3次 累计金额在18万~22万，转入1次，金额20万。交易时间在22:00~06:00,四笔交易放在3个分区以上)-----------
--1.造转入数据的1笔交易数据。
insert into table rrs_bdm_cust_transdetail_mid partition(ds ='2023-12-17',sysid='DEPOSIT') values
('2020-02-01','99996','202109271TRANS6110000574','1101','202109271BUS2061000000574','I10000000050574','9999602510110000040574','2020-02-01','022442647','CNY','000228','转账汇款','200000','300000','I10000000057630','STR0012-对手001','323584000888','深圳前海微众银行','MB','0','SYS_MB','ff91fac8a8ba52c5012a4f61953d0574',NULL,'0','0','0','0','1','101001','101001',NULL,NULL,NULL,NULL,NULL,NULL,'1580495082','N','0','1','0925467535197630',NULL,'9999602510110000040574','DEPOSIT','CARDNO202003050090574','疑似赌博犯罪-个人001',NULL,NULL,NULL,NULL,NULL,NULL,NULL,'A',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'0','0',NULL,NULL),
--2.造转出的3笔交易数据 (第1笔交易80000，第2笔交易85000，第3笔交易30000，且在不同的天)
('2020-02-01','99996','202109271TRANS6110010574','1102','202109271BUS2061000010574','I10000000050574','9999602510110000040574','2020-02-01','034536647','CNY','000229','消费支付','80000','220000','I10000000057630','STR0012-对手001','323584000888','深圳前海微众银行','MB','0','SYS_MB','ff91fac8a8ba52c5012a4f61953e0574',NULL,'0','0','0','0','0','101001','101001',NULL,NULL,NULL,NULL,NULL,NULL,'1580499936','N','0','1','0925467535197630',NULL,'9999602510110000040574','DEPOSIT','CARDNO202003050090574','疑似赌博犯罪-个人001',NULL,NULL,NULL,NULL,NULL,NULL,NULL,'A',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'0','0',NULL,NULL);

insert into table rrs_bdm_cust_transdetail_mid partition(ds ='2023-12-16',sysid='DEPOSIT') values
('2020-01-31','99996','202109271TRANS6110020574','1103','202109271BUS2061000020574','I10000000050574','9999602510110000040574','2020-01-31','012812645','CNY','000229','消费支付','85000','100000','I10000000057630','STR0012-对手001','323584000888','深圳前海微众银行','MB','0','SYS_MB','ff91fac8a8ba52c5012a4f61953f0574',NULL,'0','0','0','0','0','101001','101001',NULL,NULL,NULL,NULL,NULL,NULL,'1580405292','N','0','1','0925467535197630',NULL,'9999602510110000040574','DEPOSIT','CARDNO202003050090574','疑似赌博犯罪-个人001',NULL,NULL,NULL,NULL,NULL,NULL,NULL,'A',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'0','0',NULL,NULL);

insert into table rrs_bdm_cust_transdetail_mid partition(ds ='2023-12-15',sysid='DEPOSIT') values
('2020-01-30','99996','202109271TRANS6110030574','1104','202109271BUS2061000030574','I10000000050574','9999602510110000040574','2020-01-30','042518643','CNY','000229','消费支付','30000','185000','I10000000057630','STR0012-对手001','323584000888','深圳前海微众银行','MB','0','SYS_MB','ff91fac8a8ba52c5012a4f61953g0574',NULL,'0','0','0','0','0','101001','101001',NULL,NULL,NULL,NULL,NULL,NULL,'1580325918','N','0','1','0925467535197630',NULL,'9999602510110000040574','DEPOSIT','CARDNO202003050090574','疑似赌博犯罪-个人001',NULL,NULL,NULL,NULL,NULL,NULL,NULL,'A',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'0','0',NULL,NULL);
